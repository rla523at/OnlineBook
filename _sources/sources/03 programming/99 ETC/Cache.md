
# Cache Policy
| 구분         | Write-Back                  | Write-Through           | Write-Combined                   |
| ---------- | --------------------------- | ----------------------- | -------------------------------- |
| 기본 동작      | 쓰기를 캐시에만 반영하고, 메모리에는 나중에 반영 | 쓰기를 캐시와 메모리에 동시에 반영     | 쓰기를 버퍼에 모았다가 한 번에 큰 블록으로 메모리에 반영 |
| 읽기 성능      | 매우 높음 (캐시에 저장)              | 높음 (캐시 활용)              | 낮음 (읽기 캐시 없음, 직접 메모리 접근)         |
| 쓰기 성능      | 높음 (캐시에 쓰고 지연 반영)           | 낮음 (모든 쓰기가 메모리에도 즉시 반영) | 연속 쓰기에서 매우 높음 (버스트 전송)           |
| 메모리 대역폭 효율 | 효율적 (불필요한 쓰기 줄임)            | 비효율적 (모든 쓰기마다 메모리 접근)   | 순차 쓰기에서 효율적, 비순차 쓰기에는 효과 낮음      |
| 데이터 일관성    | 낮음 (플러시 필요)                 | 높음 (항상 메모리와 동기화)        | 보장되지 않음 (메모리 배리어 필요)             |
| 주요 사용처     | 일반 시스템 메모리(DRAM)            | 단순/안전성이 중요한 경우          | 장치 메모리(GPU VRAM, MMIO 등)         |


## Write-Combined Cache Policy
Write-Combined(줄여서 WC) 캐시 정책은 CPU가 메모리에 접근할 때 사용하는 캐시 속성 중 하나이다. 보통 메모리 매핑된 장치(특히 그래픽 카드 VRAM 같은 고속 I/O 영역)에 적용된다.

### 기본 개념
* **Write-Combined(쓰기 결합)** 은 CPU가 연속된 쓰기 연산을 **버퍼에 모아 두었다가 한 번에 큰 블록으로 메모리에 기록하는 방식**이다.
* 일반적인 Write-Back, Write-Through 캐시와 달리 **읽기 성능 최적화는 하지 않고**, 오직 쓰기 성능 향상에 집중한다.
* 이 정책은 특히 **대용량 연속 쓰기**에서 효과적이다. 예를 들어 GPU 프레임 버퍼에 CPU가 픽셀 데이터를 밀어 넣을 때.

### 동작 방식
1. CPU가 특정 메모리 영역(WC 속성이 지정된 영역)에 연속으로 쓰기를 시도한다.
2. CPU는 개별 쓰기를 즉시 메모리에 보내지 않고, **Write Combine Buffer(WCB)** 에 일시적으로 저장한다.
3. 버퍼가 가득 차거나, 특정 동기화 이벤트(메모리 배리어, 명령 순서 제약 등)가 발생하면, 한 번에 긴 버스트 전송으로 메모리에 기록한다.
4. 이로 인해 **버스 트랜잭션 수가 줄어들고, 전송 효율이 높아진다.**

### 특징
* **읽기 최적화 없음**: WC 영역에서의 읽기는 캐시되지 않고, CPU는 매번 직접 메모리(또는 장치)에서 가져온다. 따라서 읽기 성능은 떨어진다.
* **순차 쓰기에 유리**: 연속된 메모리 쓰기는 버퍼에 모아져 대역폭 효율을 크게 높인다.
* **비순차 쓰기엔 불리**: 임의 주소에 흩어져 쓰면 버퍼링 효과가 줄어든다.
* **비휘발성 보장 없음**: WC는 기본적으로 장치 메모리에 “전송 효율”을 높이기 위한 것이며, 쓰기 순서 보장·지속성 보장은 별도의 메모리 배리어나 플러시가 필요하다.

### 활용 예시
* GPU VRAM 매핑 영역: CPU가 픽셀·텍스처 데이터를 전송할 때 WC 속성을 사용하면 **PCIe 전송 효율**이 향상된다.
* 고속 I/O 메모리: 네트워크 카드, DMA 버퍼, 디스플레이 어댑터 등.
* 반대로 **일반 DRAM(시스템 메모리)** 영역에는 잘 쓰지 않는다. (거긴 Write-Back 캐시가 더 적합)

### 정리
Write-Combined 캐시 정책은
* “쓰기 효율 극대화, 읽기 성능 최소화”라는 특징을 가지며,
* CPU ↔ 장치 메모리 사이의 대량 순차 쓰기 시 유용하다.
* 대표적으로 그래픽스 VRAM에 CPU가 데이터를 빠르게 밀어 넣을 때 쓰인다.

## Wirte-Back Cache
write-back cache 정책은 컴퓨터의 캐시 메모리 관리 기법 중 하나로, 캐시에 쓰기 연산이 발생했을 때 데이터를 **즉시 메인 메모리(RAM 등)에 반영하지 않고, 캐시에만 기록해두었다가 나중에 필요할 때 메모리에 반영하는 방식**을 말한다.

### 동작 원리
1. CPU가 데이터를 수정할 때 메인 메모리가 아닌 캐시에 먼저 기록한다.
2. 캐시의 해당 블록은 "dirty bit(수정됨을 표시하는 플래그)"가 설정된다.
3. 이후 이 캐시 블록이 교체(evict)될 때, dirty bit가 설정되어 있으면 그제서야 메인 메모리에 데이터를 반영한다.
4. dirty bit가 없거나 클린 상태라면 메모리에 쓰기 작업을 하지 않고 단순히 교체된다.

### 장점
* **성능 향상**: 메인 메모리에 대한 쓰기 횟수를 줄이므로 CPU-메모리 간 병목을 완화한다.
* **쓰기 효율**: 같은 주소에 여러 번 쓰기가 발생해도 메모리에는 마지막 결과만 반영하면 되므로 불필요한 메모리 접근을 줄일 수 있다.

### 단점
* **데이터 일관성 문제**: 캐시에만 값이 반영되고 메인 메모리에 아직 반영되지 않은 동안, 다른 장치나 프로세서가 메모리에 접근하면 최신 값이 아닌 오래된 값( stale value ) 을 읽을 수 있다.
* **복잡한 관리**: 멀티코어 환경에서는 캐시 일관성(Cache Coherency)을 보장하기 위해 MESI와 같은 프로토콜을 반드시 사용해야 한다.
* **전원 장애 시 위험**: 캐시에만 기록된 데이터가 메모리에 반영되기 전에 시스템이 종료되면 데이터 유실이 발생할 수 있다.
